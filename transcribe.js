let to_grantha = {
  'à¤€': 'ð‘Œ€',
  'à¤': 'ð‘Œ',
  'à¤‚': 'ð‘Œ‚',
  'à¤ƒ': 'ð‘Œƒ',
  'à¤…': 'ð‘Œ…',
  'à¤†': 'ð‘Œ†',
  'à¤‡': 'ð‘Œ‡',
  'à¤ˆ': 'ð‘Œˆ',
  'à¤‰': 'ð‘Œ‰',
  'à¤Š': 'ð‘ŒŠ',
  'à¤‹': 'ð‘Œ‹',
  'à¤Œ': 'ð‘ŒŒ',
  'à¤': 'ð‘Œ',
  'à¤': 'ð‘Œ',
  'à¤“': 'ð‘Œ“',
  'à¤”': 'ð‘Œ”',
  'à¤•': 'ð‘Œ•',
  'à¤–': 'ð‘Œ–',
  'à¤—': 'ð‘Œ—',
  'à¤˜': 'ð‘Œ˜',
  'à¤™': 'ð‘Œ™',
  'à¤š': 'ð‘Œš',
  'à¤›': 'ð‘Œ›',
  'à¤œ': 'ð‘Œœ',
  'à¤': 'ð‘Œ',
  'à¤ž': 'ð‘Œž',
  'à¤Ÿ': 'ð‘ŒŸ',
  'à¤ ': 'ð‘Œ ',
  'à¤¡': 'ð‘Œ¡',
  'à¤¢': 'ð‘Œ¢',
  'à¤£': 'ð‘Œ£',
  'à¤¤': 'ð‘Œ¤',
  'à¤¥': 'ð‘Œ¥',
  'à¤¦': 'ð‘Œ¦',
  'à¤§': 'ð‘Œ§',
  'à¤¨': 'ð‘Œ¨',
  'à¤ª': 'ð‘Œª',
  'à¤«': 'ð‘Œ«',
  'à¤¬': 'ð‘Œ¬',
  'à¤­': 'ð‘Œ­',
  'à¤®': 'ð‘Œ®',
  'à¤¯': 'ð‘Œ¯',
  'à¤°': 'ð‘Œ°',
  'à¤²': 'ð‘Œ²',
  'à¤³': 'ð‘Œ³',
  'à¤µ': 'ð‘Œµ',
  'à¤¶': 'ð‘Œ¶',
  'à¤·': 'ð‘Œ·',
  'à¤¸': 'ð‘Œ¸',
  'à¤¹': 'ð‘Œ¹',
  'à¤¼': 'ð‘Œ¼',
  'à¤½': 'ð‘Œ½',
  'à¤¾': 'ð‘Œ¾',
  'à¤¿': 'ð‘Œ¿',
  'à¥€': 'ð‘€',
  'à¥': 'ð‘',
  'à¥‚': 'ð‘‚',
  'à¥ƒ': 'ð‘ƒ',
  'à¥„': 'ð‘„',
  'à¥‡': 'ð‘‡',
  'à¥ˆ': 'ð‘ˆ',
  'à¥‹': 'ð‘‹',
  'à¥Œ': 'ð‘Œ',
  'à¥': 'ð‘',
  'à¥': 'ð‘',
  'à¥—': 'ð‘—',
  'à¥ ': 'ð‘ ',
  'à¥¡': 'ð‘¡',
  'à¥¢': 'ð‘¢',
  'à¥£': 'ð‘£',
  'à¥¤': 'à¥¤',
  'à¥¥': 'à¥¥',
  'à¥¦': 'à¯¦',
  'à¥§': 'à¯§',
  'à¥¨': 'à¯¨',
  'à¥©': 'à¯©',
  'à¥ª': 'à¯ª',
  'à¥«': 'à¯«',
  'à¥¬': 'à¯¬',
  'à¥­': 'à¯­',
  'à¥®': 'à¯®',
  'à¥¯': 'à¯¯',
};

let to_brahmi = {
  'à¤': 'ð‘€€',
  'à¤‚': 'ð‘€',
  'à¤ƒ': 'ð‘€‚',
  'à¤…': 'ð‘€…',
  'à¤†': 'ð‘€†',
  'à¤‡': 'ð‘€‡',
  'à¤ˆ': 'ð‘€ˆ',
  'à¤‰': 'ð‘€‰',
  'à¤Š': 'ð‘€Š',
  'à¤‹': 'ð‘€‹',
  'à¤Œ': 'ð‘€',
  'à¤': 'ð‘€',
  'à¤': 'ð‘€',
  'à¤“': 'ð‘€‘',
  'à¤”': 'ð‘€’',
  'à¤•': 'ð‘€“',
  'à¤–': 'ð‘€”',
  'à¤—': 'ð‘€•',
  'à¤˜': 'ð‘€–',
  'à¤™': 'ð‘€—',
  'à¤š': 'ð‘€˜',
  'à¤›': 'ð‘€™',
  'à¤œ': 'ð‘€š',
  'à¤': 'ð‘€›',
  'à¤ž': 'ð‘€œ',
  'à¤Ÿ': 'ð‘€',
  'à¤ ': 'ð‘€ž',
  'à¤¡': 'ð‘€Ÿ',
  'à¤¢': 'ð‘€ ',
  'à¤£': 'ð‘€¡',
  'à¤¤': 'ð‘€¢',
  'à¤¥': 'ð‘€£',
  'à¤¦': 'ð‘€¤',
  'à¤§': 'ð‘€¥',
  'à¤¨': 'ð‘€¦',
  'à¤©': 'ð‘€·',
  'à¤ª': 'ð‘€§',
  'à¤«': 'ð‘€¨',
  'à¤¬': 'ð‘€©',
  'à¤­': 'ð‘€ª',
  'à¤®': 'ð‘€«',
  'à¤¯': 'ð‘€¬',
  'à¤°': 'ð‘€­',
  'à¤±': 'ð‘€¶',
  'à¤²': 'ð‘€®',
  'à¤³': 'ð‘€´',
  'à¤´': 'ð‘€µ',
  'à¤µ': 'ð‘€¯',
  'à¤¶': 'ð‘€°',
  'à¤·': 'ð‘€±',
  'à¤¸': 'ð‘€²',
  'à¤¹': 'ð‘€³',
  'à¤¾': 'ð‘€¸',
  'à¤¿': 'ð‘€º',
  'à¥€': 'ð‘€»',
  'à¥': 'ð‘€¼',
  'à¥‚': 'ð‘€½',
  'à¥ƒ': 'ð‘€¾',
  'à¥„': 'ð‘€¿',
  'à¥‡': 'ð‘‚',
  'à¥ˆ': 'ð‘ƒ',
  'à¥‹': 'ð‘„',
  'à¥Œ': 'ð‘…',
  'à¥': 'ð‘†',
  'à¥ ': 'ð‘€Œ',
  'à¥¡': 'ð‘€Ž',
  'à¥¢': 'ð‘€',
  'à¥£': 'ð‘',
  'à¥¤': 'ð‘‡',
  'à¥¥': 'ð‘ˆ',
  'à¥¦': 'ð‘¦',
  'à¥§': 'ð‘§',
  'à¥¨': 'ð‘¨',
  'à¥©': 'ð‘©',
  'à¥ª': 'ð‘ª',
  'à¥«': 'ð‘«',
  'à¥¬': 'ð‘¬',
  'à¥­': 'ð‘­',
  'à¥®': 'ð‘®',
  'à¥¯': 'ð‘¯',
};

let from_grantha = {};
for (let key in to_grantha) {
  from_grantha[to_grantha[key]] = key;
}
let from_brahmi = {};
for (let key in to_brahmi) {
  from_brahmi[to_brahmi[key]] = key;
}

function transcribe_string(string, mapping) {
  let chars = [...string];
  chars = chars.map(x => {
    if (x in mapping) {
      return mapping[x];
    } else {
      return x;
    }
  });
  return chars.join("");
}

function transcribe(node, mapping) {
  if (node.nodeType === Node.TEXT_NODE) {
    node.nodeValue = transcribe_string(node.nodeValue, mapping);
  } else if (node.nodeType === Node.ELEMENT_NODE) {
    if (node.lang !== "") return;
    for (let i = 0; i < node.childNodes.length; i++) {
      let child = node.childNodes[i];
      transcribe(child, mapping);
    }
  }
}

function set_script(script) {
  document.getElementById("grantha").disabled = false;
  document.getElementById("devanagari").disabled = false;
  document.getElementById("brahmi").disabled = false;
  document.getElementById("grantha-name").style.display = "inline";
  document.getElementById("devanagari-name").style.display = "inline";
  document.getElementById("brahmi-name").style.display = "inline";

  document.getElementById(script).disabled = true;
  document.getElementById(script + "-name").style.display = "none";
}

function grantha() {
  devanagari();
  transcribe(document.body, to_grantha);
  document.title = transcribe_string(document.title, to_grantha);
  document.documentElement.lang = "sa-Gran";
  window.history.replaceState("", document.title, window.location.pathname + "?grantha");
  set_script("grantha");
}

function brahmi() {
  devanagari();
  transcribe(document.body, to_brahmi);
  document.title = transcribe_string(document.title, to_brahmi);
  document.documentElement.lang = "sa-Gran";
  window.history.replaceState("", document.title, window.location.pathname + "?brahmi");
  set_script("brahmi");
}

function devanagari() {
  transcribe(document.body, from_brahmi);
  transcribe(document.body, from_grantha);
  document.title = transcribe_string(document.title, from_grantha);
  document.title = transcribe_string(document.title, from_brahmi);
  document.documentElement.lang = "sa";
  window.history.replaceState("", document.title, window.location.pathname);
  set_script("devanagari");
}
