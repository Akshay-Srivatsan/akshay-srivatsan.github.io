let brahmic_map = [
  {
    "Devanagari": "ॐ",
    "Grantha": "𑍐",
    "Brahmi": "ॐ",
    "Tamil": "ௐ",
    "ISO": "ॐ"
  },
  {
    "Devanagari": "◌ऀ",
    "Grantha": "◌𑌀",
    "Brahmi": "◌𑀀",
    "Tamil": "◌ஂ",
    "ISO": "m̐"
  },
  {
    "Devanagari": "◌ँ",
    "Grantha": "◌𑌁",
    "Brahmi": "◌𑀀",
    "Tamil": "◌ஂ",
    "ISO": "m̐"
  },
  {
    "Devanagari": "◌ं",
    "Grantha": "◌𑌂",
    "Brahmi": "◌𑀁",
    "Tamil": "◌ஂ",
    "ISO": "ṁ"
  },
  {
    "Devanagari": "◌ः",
    "Grantha": "◌𑌃",
    "Brahmi": "◌𑀂",
    "Tamil": "◌𑌃",
    "ISO": "ḥ"
  },
  {
    "Devanagari": "◌़",
    "Grantha": "◌𑌼",
    "Brahmi": "",
    "Tamil": "",
    "ISO": ""
  },
  {
    "Devanagari": "।",
    "Grantha": "।",
    "Brahmi": "𑁇",
    "Tamil": ".",
    "ISO": "."
  },
  {
    "Devanagari": "॥",
    "Grantha": "॥",
    "Brahmi": "𑁈",
    "Tamil": ".",
    "ISO": "."
  },
  {
    "Devanagari": "॰",
    "Grantha": ".",
    "Brahmi": "𑁉",
    "Tamil": ".",
    "ISO": "."
  },
  {
    "Devanagari": "ॱ",
    "Grantha": "-",
    "Brahmi": "𑁋",
    "Tamil": "-",
    "ISO": "-"
  },
  {
    "Devanagari": "ऽ",
    "Grantha": "𑌽",
    "Brahmi": "𑀅",
    "Tamil": "அ",
    "ISO": "'"
  },
  {
    "Devanagari": "अ",
    "Grantha": "𑌅",
    "Brahmi": "𑀅",
    "Tamil": "அ",
    "ISO": "a"
  },
  {
    "Devanagari": "ऄ",
    "Grantha": "𑌅",
    "Brahmi": "𑀅",
    "Tamil": "அ",
    "ISO": "a"
  },
  {
    "Devanagari": "आ",
    "Grantha": "𑌆",
    "Brahmi": "𑀆",
    "Tamil": "ஆ",
    "ISO": "ā"
  },
  {
    "Devanagari": "इ",
    "Grantha": "𑌇",
    "Brahmi": "𑀇",
    "Tamil": "இ",
    "ISO": "i"
  },
  {
    "Devanagari": "ई",
    "Grantha": "𑌈",
    "Brahmi": "𑀈",
    "Tamil": "ஈ",
    "ISO": "ī"
  },
  {
    "Devanagari": "उ",
    "Grantha": "𑌉",
    "Brahmi": "𑀉",
    "Tamil": "உ",
    "ISO": "u"
  },
  {
    "Devanagari": "ऊ",
    "Grantha": "𑌊",
    "Brahmi": "𑀊",
    "Tamil": "ஊ",
    "ISO": "ū"
  },
  {
    "Devanagari": "ऋ",
    "Grantha": "𑌋",
    "Brahmi": "𑀋",
    "Tamil": "ரு’",
    "ISO": "r̥"
  },
  {
    "Devanagari": "ॠ",
    "Grantha": "𑍠",
    "Brahmi": "𑀌",
    "Tamil": "ரூ’",
    "ISO": "r̥̄"
  },
  {
    "Devanagari": "ऌ",
    "Grantha": "𑌌",
    "Brahmi": "𑀍",
    "Tamil": "லு’",
    "ISO": "l̥"
  },
  {
    "Devanagari": "ॡ",
    "Grantha": "𑍡",
    "Brahmi": "𑀎",
    "Tamil": "லூ’",
    "ISO": "l̥̄"
  },
  {
    "Devanagari": "ऍ",
    "Grantha": "𑌅",
    "Brahmi": "𑀅",
    "Tamil": "அ",
    "ISO": "ê"
  },
  {
    "Devanagari": "ए",
    "Grantha": "𑌏",
    "Brahmi": "𑀏",
    "Tamil": "ஏ",
    "ISO": "ē"
  },
  {
    "Devanagari": "ऎ",
    "Grantha": "𑌏",
    "Brahmi": "𑀏",
    "Tamil": "எ",
    "ISO": "e"
  },
  {
    "Devanagari": "ऐ",
    "Grantha": "𑌐",
    "Brahmi": "𑀐",
    "Tamil": "ஐ",
    "ISO": "ai"
  },
  {
    "Devanagari": "ऑ",
    "Grantha": "𑌆",
    "Brahmi": "𑀆",
    "Tamil": "ஆ",
    "ISO": "ô"
  },
  {
    "Devanagari": "ओ",
    "Grantha": "𑌓",
    "Brahmi": "𑀑",
    "Tamil": "ஓ",
    "ISO": "ō"
  },
  {
    "Devanagari": "ऒ",
    "Grantha": "𑌓",
    "Brahmi": "𑀑",
    "Tamil": "ஒ",
    "ISO": "o"
  },
  {
    "Devanagari": "औ",
    "Grantha": "𑌔",
    "Brahmi": "𑀒",
    "Tamil": "ஔ",
    "ISO": "au"
  },
  {
    "Devanagari": "◌्",
    "Grantha": "◌𑍍",
    "Brahmi": "◌𑁆",
    "Tamil": "்",
    "ISO": "\b"
  },
  {
    "Devanagari": "◌ा",
    "Grantha": "◌𑌾",
    "Brahmi": "◌𑀸",
    "Tamil": "◌ா",
    "ISO": "\bā"
  },
  {
    "Devanagari": "◌ि",
    "Grantha": "◌𑌿",
    "Brahmi": "◌𑀺",
    "Tamil": "◌ி",
    "ISO": "\bi"
  },
  {
    "Devanagari": "◌ी",
    "Grantha": "◌𑍀",
    "Brahmi": "◌𑀻",
    "Tamil": "◌ீ",
    "ISO": "\bī"
  },
  {
    "Devanagari": "◌ु",
    "Grantha": "◌𑍁",
    "Brahmi": "◌𑀼",
    "Tamil": "◌ு",
    "ISO": "\bu"
  },
  {
    "Devanagari": "◌ू",
    "Grantha": "◌𑍂",
    "Brahmi": "◌𑀽",
    "Tamil": "◌ூ",
    "ISO": "\bū"
  },
  {
    "Devanagari": "◌ृ",
    "Grantha": "◌𑍃",
    "Brahmi": "◌𑀾",
    "Tamil": "்ரு’",
    "ISO": "\br̥"
  },
  {
    "Devanagari": "◌ॄ",
    "Grantha": "◌𑍄",
    "Brahmi": "◌𑀿",
    "Tamil": "்ரூ’",
    "ISO": "\br̥̄"
  },
  {
    "Devanagari": "◌ॢ",
    "Grantha": "◌𑍢",
    "Brahmi": "◌𑁀",
    "Tamil": "்லு’",
    "ISO": "\bl̥"
  },
  {
    "Devanagari": "◌ॣ",
    "Grantha": "◌𑍣",
    "Brahmi": "◌𑁁",
    "Tamil": "்லூ’",
    "ISO": "\bl̥̄"
  },
  {
    "Devanagari": "◌ॅ",
    "Grantha": "",
    "Brahmi": "",
    "Tamil": "",
    "ISO": "\bê"
  },
  {
    "Devanagari": "◌ॆ",
    "Grantha": "◌𑍇",
    "Brahmi": "◌𑁂",
    "Tamil": "◌ெ",
    "ISO": "\be"
  },
  {
    "Devanagari": "◌े",
    "Grantha": "◌𑍇",
    "Brahmi": "◌𑁂",
    "Tamil": "◌ே",
    "ISO": "\bē"
  },
  {
    "Devanagari": "◌ै",
    "Grantha": "◌𑍈",
    "Brahmi": "◌𑁃",
    "Tamil": "◌ை",
    "ISO": "\bai"
  },
  {
    "Devanagari": "◌ॉ",
    "Grantha": "◌𑌾",
    "Brahmi": "◌𑀸",
    "Tamil": "◌ா",
    "ISO": "\bô"
  },
  {
    "Devanagari": "◌ॊ",
    "Grantha": "◌𑍋",
    "Brahmi": "◌𑁄",
    "Tamil": "◌ொ",
    "ISO": "\bo"
  },
  {
    "Devanagari": "◌ो",
    "Grantha": "◌𑍋",
    "Brahmi": "◌𑁄",
    "Tamil": "◌ோ",
    "ISO": "\bō"
  },
  {
    "Devanagari": "◌ौ",
    "Grantha": "◌𑍌",
    "Brahmi": "◌𑁅",
    "Tamil": "◌ௌ",
    "ISO": "\bau"
  },
  {
    "Devanagari": "क",
    "Grantha": "𑌕",
    "Brahmi": "𑀓",
    "Tamil": "க",
    "ISO": "ka"
  },
  {
    "Devanagari": "ख",
    "Grantha": "𑌖",
    "Brahmi": "𑀔",
    "Tamil": "க²",
    "ISO": "kha"
  },
  {
    "Devanagari": "ग",
    "Grantha": "𑌗",
    "Brahmi": "𑀕",
    "Tamil": "க³",
    "ISO": "ga"
  },
  {
    "Devanagari": "घ",
    "Grantha": "𑌘",
    "Brahmi": "𑀖",
    "Tamil": "க⁴",
    "ISO": "gha"
  },
  {
    "Devanagari": "ङ",
    "Grantha": "𑌙",
    "Brahmi": "𑀗",
    "Tamil": "ங",
    "ISO": "ṅa"
  },
  {
    "Devanagari": "च",
    "Grantha": "𑌚",
    "Brahmi": "𑀘",
    "Tamil": "ச",
    "ISO": "ca"
  },
  {
    "Devanagari": "छ",
    "Grantha": "𑌛",
    "Brahmi": "𑀙",
    "Tamil": "ச²",
    "ISO": "cha"
  },
  {
    "Devanagari": "ज",
    "Grantha": "𑌜",
    "Brahmi": "𑀚",
    "Tamil": "ஜ",
    "ISO": "ja"
  },
  {
    "Devanagari": "झ",
    "Grantha": "𑌝",
    "Brahmi": "𑀛",
    "Tamil": "ஜ²",
    "ISO": "jha"
  },
  {
    "Devanagari": "ञ",
    "Grantha": "𑌞",
    "Brahmi": "𑀜",
    "Tamil": "ஞ",
    "ISO": "ña"
  },
  {
    "Devanagari": "ट",
    "Grantha": "𑌟",
    "Brahmi": "𑀝",
    "Tamil": "ட",
    "ISO": "ṭa"
  },
  {
    "Devanagari": "ठ",
    "Grantha": "𑌠",
    "Brahmi": "𑀞",
    "Tamil": "ட²",
    "ISO": "ṭha"
  },
  {
    "Devanagari": "ड",
    "Grantha": "𑌡",
    "Brahmi": "𑀟",
    "Tamil": "ட³",
    "ISO": "ḍa"
  },
  {
    "Devanagari": "ढ",
    "Grantha": "𑌢",
    "Brahmi": "𑀠",
    "Tamil": "ட⁴",
    "ISO": "ḍha"
  },
  {
    "Devanagari": "ण",
    "Grantha": "𑌣",
    "Brahmi": "𑀡",
    "Tamil": "ண",
    "ISO": "ṇa"
  },
  {
    "Devanagari": "त",
    "Grantha": "𑌤",
    "Brahmi": "𑀢",
    "Tamil": "த",
    "ISO": "ta"
  },
  {
    "Devanagari": "थ",
    "Grantha": "𑌥",
    "Brahmi": "𑀣",
    "Tamil": "த²",
    "ISO": "tha"
  },
  {
    "Devanagari": "द",
    "Grantha": "𑌦",
    "Brahmi": "𑀤",
    "Tamil": "த³",
    "ISO": "da"
  },
  {
    "Devanagari": "ध",
    "Grantha": "𑌧",
    "Brahmi": "𑀥",
    "Tamil": "த⁴",
    "ISO": "dha"
  },
  {
    "Devanagari": "न",
    "Grantha": "𑌨",
    "Brahmi": "𑀦",
    "Tamil": "ந",
    "ISO": "na"
  },
  {
    "Devanagari": "ऩ",
    "Grantha": "𑌨",
    "Brahmi": "𑀷",
    "Tamil": "ன",
    "ISO": "ṉa"
  },
  {
    "Devanagari": "प",
    "Grantha": "𑌪",
    "Brahmi": "𑀧",
    "Tamil": "ப",
    "ISO": "pa"
  },
  {
    "Devanagari": "फ",
    "Grantha": "𑌫",
    "Brahmi": "𑀨",
    "Tamil": "ப²",
    "ISO": "pha"
  },
  {
    "Devanagari": "ब",
    "Grantha": "𑌬",
    "Brahmi": "𑀩",
    "Tamil": "ப³",
    "ISO": "ba"
  },
  {
    "Devanagari": "भ",
    "Grantha": "𑌭",
    "Brahmi": "𑀪",
    "Tamil": "ப⁴",
    "ISO": "bha"
  },
  {
    "Devanagari": "म",
    "Grantha": "𑌮",
    "Brahmi": "𑀫",
    "Tamil": "ம",
    "ISO": "ma"
  },
  {
    "Devanagari": "य",
    "Grantha": "𑌯",
    "Brahmi": "𑀬",
    "Tamil": "ய",
    "ISO": "ya"
  },
  {
    "Devanagari": "र",
    "Grantha": "𑌰",
    "Brahmi": "𑀭",
    "Tamil": "ர",
    "ISO": "ra"
  },
  {
    "Devanagari": "ऱ",
    "Grantha": "𑌰𑌼",
    "Brahmi": "𑀶",
    "Tamil": "ற",
    "ISO": "ṟa"
  },
  {
    "Devanagari": "ल",
    "Grantha": "𑌲",
    "Brahmi": "𑀮",
    "Tamil": "ல",
    "ISO": "la"
  },
  {
    "Devanagari": "ळ",
    "Grantha": "𑌳",
    "Brahmi": "𑀴",
    "Tamil": "ள",
    "ISO": "ḷa"
  },
  {
    "Devanagari": "ऴ",
    "Grantha": "𑌳𑌼",
    "Brahmi": "𑀵",
    "Tamil": "ழ",
    "ISO": "ḻa"
  },
  {
    "Devanagari": "व",
    "Grantha": "𑌵",
    "Brahmi": "𑀯",
    "Tamil": "வ",
    "ISO": "va"
  },
  {
    "Devanagari": "श",
    "Grantha": "𑌶",
    "Brahmi": "𑀰",
    "Tamil": "ஶ",
    "ISO": "śa"
  },
  {
    "Devanagari": "ष",
    "Grantha": "𑌷",
    "Brahmi": "𑀱",
    "Tamil": "ஷ",
    "ISO": "ṣa"
  },
  {
    "Devanagari": "स",
    "Grantha": "𑌸",
    "Brahmi": "𑀲",
    "Tamil": "ஸ",
    "ISO": "sa"
  },
  {
    "Devanagari": "ह",
    "Grantha": "𑌹",
    "Brahmi": "𑀳",
    "Tamil": "ஹ",
    "ISO": "ha"
  },
  {
    "Devanagari": "क़",
    "Grantha": "𑌕𑌼",
    "Brahmi": "𑀓",
    "Tamil": "ஃக",
    "ISO": "qa"
  },
  {
    "Devanagari": "ख़",
    "Grantha": "𑌖𑌼",
    "Brahmi": "𑀔",
    "Tamil": "ஃக²",
    "ISO": "k͟ha"
  },
  {
    "Devanagari": "ग़",
    "Grantha": "𑌗𑌼",
    "Brahmi": "𑀕",
    "Tamil": "ஃக³",
    "ISO": "ġa"
  },
  {
    "Devanagari": "ज़",
    "Grantha": "𑌜𑌼",
    "Brahmi": "𑀚",
    "Tamil": "ஃஜ",
    "ISO": "za"
  },
  {
    "Devanagari": "ड़",
    "Grantha": "𑌡𑌼",
    "Brahmi": "𑀟",
    "Tamil": "ஃட²",
    "ISO": "ṛa"
  },
  {
    "Devanagari": "ढ़",
    "Grantha": "𑌢𑌼",
    "Brahmi": "𑀠",
    "Tamil": "ஃட³",
    "ISO": "ṛha"
  },
  {
    "Devanagari": "फ़",
    "Grantha": "𑌫𑌼",
    "Brahmi": "𑀨",
    "Tamil": "ஃப",
    "ISO": "fa"
  },
  {
    "Devanagari": "झ़",
    "Grantha": "𑌝𑌼",
    "Brahmi": "𑀛",
    "Tamil": "ஃஜ²",
    "ISO": "ža"
  },
  {
    "Devanagari": "०",
    "Grantha": "௦",
    "Brahmi": "𑁦",
    "Tamil": "௦",
    "ISO": 0
  },
  {
    "Devanagari": "१",
    "Grantha": "௧",
    "Brahmi": "𑁧",
    "Tamil": "௧",
    "ISO": 1
  },
  {
    "Devanagari": "२",
    "Grantha": "௨",
    "Brahmi": "𑁨",
    "Tamil": "௨",
    "ISO": 2
  },
  {
    "Devanagari": "३",
    "Grantha": "௩",
    "Brahmi": "𑁩",
    "Tamil": "௩",
    "ISO": 3
  },
  {
    "Devanagari": "४",
    "Grantha": "௪",
    "Brahmi": "𑁪",
    "Tamil": "௪",
    "ISO": 4
  },
  {
    "Devanagari": "५",
    "Grantha": "௫",
    "Brahmi": "𑁫",
    "Tamil": "௫",
    "ISO": 5
  },
  {
    "Devanagari": "६",
    "Grantha": "௬",
    "Brahmi": "𑁬",
    "Tamil": "௬",
    "ISO": 6
  },
  {
    "Devanagari": "७",
    "Grantha": "௭",
    "Brahmi": "𑁭",
    "Tamil": "௭",
    "ISO": 7
  },
  {
    "Devanagari": "८",
    "Grantha": "௮",
    "Brahmi": "𑁮",
    "Tamil": "௮",
    "ISO": 8
  },
  {
    "Devanagari": "९",
    "Grantha": "௯",
    "Brahmi": "𑁯",
    "Tamil": "௯",
    "ISO": 9
  }
];

let ipa_map = [
  {
    "ISO": "m̐",
    "Sanskrit": "◌̃",
    "Hindi": "◌̃",
    "Tamil": "◌̃"
  },
  {
    "ISO": "m̐",
    "Sanskrit": "◌̃",
    "Hindi": "◌̃",
    "Tamil": "◌̃"
  },
  {
    "ISO": "ṁ",
    "Sanskrit": "◌̃",
    "Hindi": "◌̃",
    "Tamil": "◌̃"
  },
  {
    "ISO": "ḥ",
    "Sanskrit": "h",
    "Hindi": "h",
    "Tamil": "h"
  },
  {
    "ISO": "a",
    "Sanskrit": "ɐ",
    "Hindi": "ə",
    "Tamil": "a"
  },
  {
    "ISO": "ā",
    "Sanskrit": "aː",
    "Hindi": "aː",
    "Tamil": "aː"
  },
  {
    "ISO": "i",
    "Sanskrit": "ɪ",
    "Hindi": "ɪ",
    "Tamil": "i"
  },
  {
    "ISO": "ī",
    "Sanskrit": "iː",
    "Hindi": "iː",
    "Tamil": "iː"
  },
  {
    "ISO": "u",
    "Sanskrit": "ʊ",
    "Hindi": "ʊ",
    "Tamil": "u"
  },
  {
    "ISO": "ū",
    "Sanskrit": "uː",
    "Hindi": "uː",
    "Tamil": "uː"
  },
  {
    "ISO": "r̥",
    "Sanskrit": "r̩",
    "Hindi": "r̩",
    "Tamil": "r̩"
  },
  {
    "ISO": "l̥",
    "Sanskrit": "l̩",
    "Hindi": "l̩",
    "Tamil": "l̩"
  },
  {
    "ISO": "ê",
    "Sanskrit": "æ",
    "Hindi": "æ",
    "Tamil": "æ"
  },
  {
    "ISO": "e",
    "Sanskrit": "e",
    "Hindi": "ɛ",
    "Tamil": "e"
  },
  {
    "ISO": "ē",
    "Sanskrit": "eː",
    "Hindi": "eː",
    "Tamil": "eː"
  },
  {
    "ISO": "ai",
    "Sanskrit": "ɐːi̯",
    "Hindi": "ɛː",
    "Tamil": "aɪ"
  },
  {
    "ISO": "ô",
    "Sanskrit": "ɔ",
    "Hindi": "ɔ",
    "Tamil": "ɔ"
  },
  {
    "ISO": "o",
    "Sanskrit": "o",
    "Hindi": "o",
    "Tamil": "o"
  },
  {
    "ISO": "ō",
    "Sanskrit": "oː",
    "Hindi": "oː",
    "Tamil": "oː"
  },
  {
    "ISO": "au",
    "Sanskrit": "ɐːu̯",
    "Hindi": "ɔː",
    "Tamil": "aʊ"
  },
  {
    "ISO": "k",
    "Sanskrit": "k",
    "Hindi": "k",
    "Tamil": "k"
  },
  {
    "ISO": "kh",
    "Sanskrit": "kʰ",
    "Hindi": "kʰ",
    "Tamil": "k"
  },
  {
    "ISO": "g",
    "Sanskrit": "ɡ",
    "Hindi": "ɡ",
    "Tamil": "k"
  },
  {
    "ISO": "gh",
    "Sanskrit": "ɡʱ",
    "Hindi": "ɡʱ",
    "Tamil": "k"
  },
  {
    "ISO": "ṅ",
    "Sanskrit": "ŋ",
    "Hindi": "ŋ",
    "Tamil": "ŋ"
  },
  {
    "ISO": "c",
    "Sanskrit": "tɕ",
    "Hindi": "tʃ",
    "Tamil": "tɕ"
  },
  {
    "ISO": "ch",
    "Sanskrit": "tɕʰ",
    "Hindi": "tʃʰ",
    "Tamil": "tɕ"
  },
  {
    "ISO": "j",
    "Sanskrit": "dʑ",
    "Hindi": "dʒ",
    "Tamil": "tɕ"
  },
  {
    "ISO": "jh",
    "Sanskrit": "dʑʱ",
    "Hindi": "dʒʱ",
    "Tamil": "tɕ"
  },
  {
    "ISO": "ñ",
    "Sanskrit": "ɲ",
    "Hindi": "ɲ",
    "Tamil": "ɲ"
  },
  {
    "ISO": "ṭ",
    "Sanskrit": "ʈ",
    "Hindi": "ʈ",
    "Tamil": "ʈ"
  },
  {
    "ISO": "ṭh",
    "Sanskrit": "ʈʰ",
    "Hindi": "ʈʰ",
    "Tamil": "ʈ"
  },
  {
    "ISO": "ḍ",
    "Sanskrit": "ɖ",
    "Hindi": "ɖ",
    "Tamil": "ʈ"
  },
  {
    "ISO": "ḍh",
    "Sanskrit": "ɖʱ",
    "Hindi": "ɖʱ",
    "Tamil": "ʈ"
  },
  {
    "ISO": "ṇ",
    "Sanskrit": "ɳ",
    "Hindi": "ɳ",
    "Tamil": "ɳ"
  },
  {
    "ISO": "t",
    "Sanskrit": "t",
    "Hindi": "t",
    "Tamil": "t"
  },
  {
    "ISO": "th",
    "Sanskrit": "tʰ",
    "Hindi": "tʰ",
    "Tamil": "t"
  },
  {
    "ISO": "d",
    "Sanskrit": "d",
    "Hindi": "d",
    "Tamil": "t"
  },
  {
    "ISO": "dh",
    "Sanskrit": "dʱ",
    "Hindi": "dʱ",
    "Tamil": "t"
  },
  {
    "ISO": "n",
    "Sanskrit": "n",
    "Hindi": "n",
    "Tamil": "n"
  },
  {
    "ISO": "ṉ",
    "Sanskrit": "n̪",
    "Hindi": "n̪",
    "Tamil": "n̪"
  },
  {
    "ISO": "p",
    "Sanskrit": "p",
    "Hindi": "p",
    "Tamil": "p"
  },
  {
    "ISO": "ph",
    "Sanskrit": "pʰ",
    "Hindi": "pʰ",
    "Tamil": "p"
  },
  {
    "ISO": "b",
    "Sanskrit": "b",
    "Hindi": "b",
    "Tamil": "p"
  },
  {
    "ISO": "bh",
    "Sanskrit": "bʱ",
    "Hindi": "bʱ",
    "Tamil": "p"
  },
  {
    "ISO": "m",
    "Sanskrit": "m",
    "Hindi": "m",
    "Tamil": "m"
  },
  {
    "ISO": "y",
    "Sanskrit": "j",
    "Hindi": "j",
    "Tamil": "j"
  },
  {
    "ISO": "r",
    "Sanskrit": "r",
    "Hindi": "r",
    "Tamil": "ɾ"
  },
  {
    "ISO": "ṟ",
    "Sanskrit": "r",
    "Hindi": "r",
    "Tamil": "r"
  },
  {
    "ISO": "l",
    "Sanskrit": "l",
    "Hindi": "l",
    "Tamil": "l"
  },
  {
    "ISO": "ḷ",
    "Sanskrit": "ɭ",
    "Hindi": "ɭ",
    "Tamil": "ɭ"
  },
  {
    "ISO": "ḻ",
    "Sanskrit": "ɻ",
    "Hindi": "ɻ",
    "Tamil": "ɻ"
  },
  {
    "ISO": "v",
    "Sanskrit": "ʋ",
    "Hindi": "ʋ",
    "Tamil": "ʋ"
  },
  {
    "ISO": "ś",
    "Sanskrit": "ɕ",
    "Hindi": "ʃ",
    "Tamil": "ɕ"
  },
  {
    "ISO": "ṣ",
    "Sanskrit": "ʂ",
    "Hindi": "ʂ",
    "Tamil": "ʂ"
  },
  {
    "ISO": "s",
    "Sanskrit": "s",
    "Hindi": "s",
    "Tamil": "s"
  },
  {
    "ISO": "h",
    "Sanskrit": "ɦ",
    "Hindi": "ɦ",
    "Tamil": "ɦ"
  },
  {
    "ISO": "'",
    "Sanskrit": "(ɐ)",
    "Hindi": "(ə)",
    "Tamil": "(a)"
  },
  {
    "ISO": "q",
    "Sanskrit": "q",
    "Hindi": "q",
    "Tamil": "q"
  },
  {
    "ISO": "k͟h",
    "Sanskrit": "x",
    "Hindi": "x",
    "Tamil": "x"
  },
  {
    "ISO": "ġ",
    "Sanskrit": "ɣ",
    "Hindi": "ɣ",
    "Tamil": "ɣ"
  },
  {
    "ISO": "z",
    "Sanskrit": "z",
    "Hindi": "z",
    "Tamil": "z"
  },
  {
    "ISO": "ṛ",
    "Sanskrit": "ɽ",
    "Hindi": "ɽ",
    "Tamil": "ɽ"
  },
  {
    "ISO": "ṛh",
    "Sanskrit": "ɽʱ",
    "Hindi": "ɽʱ",
    "Tamil": "ɽʱ"
  },
  {
    "ISO": "f",
    "Sanskrit": "f",
    "Hindi": "f",
    "Tamil": "f"
  },
  {
    "ISO": "r̥̄",
    "Sanskrit": "r̩ː",
    "Hindi": "r̩ː",
    "Tamil": "r̩ː"
  },
  {
    "ISO": "l̥̄",
    "Sanskrit": "l̩ː",
    "Hindi": "l̩ː",
    "Tamil": "l̩ː"
  },
  {
    "ISO": "ḵ",
    "Sanskrit": "x",
    "Hindi": "x",
    "Tamil": "x"
  },
  {
    "ISO": ".",
    "Sanskrit": ".",
    "Hindi": ".",
    "Tamil": "."
  },
  {
    "ISO": "-",
    "Sanskrit": "-",
    "Hindi": "-",
    "Tamil": "-"
  },
  {
    "ISO": "ॐ",
    "Sanskrit": "oṃ",
    "Hindi": "oṃ",
    "Tamil": "oṃ"
  }
];

function fix_string(s) {
  if (!s.replaceAll) return s;
  s = s.normalize();
  return s.replaceAll("◌", "");
}

function fix_iso(s) {
  s = s.normalize();
  return Array.from(s).filter((x, i) => x !== '\b' && s[i+1] !==
    '\b').join("");
}

function unfix_iso(s) {
  s = s.normalize();
  let keys = brahmic_map.map(x => x.ISO);
  let as = Array.from(s);
  let types = as.map((x, i) => {
    // ◌
    if (keys.includes(x + "a")) {
      if (as[i + 1] === fix_string("◌̥")) {
        return "V";
      }
      return "C";
    } else if (keys.includes("\b" + x)) {
      return "V";
    } else if (x == "a") {
      return "A";
    } else {
      return "?";
    }
  });
  s = as.flatMap((x, i) => {
    let ty = types[i];
    let p_ty = i > 0 ? types[i-1] : "?";
    let y = i > 0 ? as[i-1] : "\0";
    let z = i < as.length - 1 ? as[i+1] : "\0";
    if (ty === "C") {
      if (x === "h" && keys.includes(y + "ha")) {
        return "";
      }
      if (z === "h" && keys.includes(x + "ha")) {
        x = x + "h";
      }
      if (p_ty === "C") {
        return "\b" + x + "a";
      }
      return x + "a";
    } else if (ty === "V") {
      if (p_ty === "C") {
        return "\b" + x;
      } else {
        return x;
      }
    } else if (ty === "A") {
      if (z === "i" || z === "u") {
        return "\ba";
      }
      if (p_ty === "C") {
        return "";
      }
      return x;
    } else {
      if (p_ty === "C") {
        return "\b" + x;
      } else {
        return x;
      }
    }
  }).join("");
  if (s.length === 0) {
    return "";
  }
  if (s[0] === "\b") {
    s = s.substr(1);
  }
  if (types[types.length - 1] === "C") {
    s += "\b";
  }
  return s;
}

function fix_ipa(s) {
  s = s.normalize();
  return Array.from(s).map((x, i) => (i > 0 && x === s[i-1] && x !== " ") ? "ː" : x).join("").replaceAll("ː̃", fix_string("◌̃ː")).replaceAll("n̪n̪", "n̪ː");
}

function fix_iso_tamil(s) {
  if (s.length === 0) return "";
  s = s.normalize();
  return fix_iso(s).replaceAll("c", "s").replaceAll("ss", "cc").replaceAll("s s", "c c").replaceAll("ñs", "ñc");
}

function fix_ipa_tamil(s) {
  s = s.normalize();
  return fix_ipa(s).replaceAll("nːr", "nːdr").replaceAll("nr", "ndr").replaceAll("rː", "tːr");
  // .replaceAll("u ", "ɯ ");
}

function fix_tamil(s) {
  let superscripts = "²³⁴";
  let diacritics = "்ாிீுூெேொோைௌ";
  let chars = Array.from(s);
  let n = s.length;
  for (let i = 0; i < n; i++) {
    let c = chars[i];
    if (superscripts.indexOf(c) !== -1) {
      let d = chars[i + 1];
      if (diacritics.indexOf(d) !== -1) {
        chars[i + 1] = c;
        chars[i] = d;
      }
    }
    if (c === "ந" && i > 0) {
      if (chars[i - 1] !== " " && !(chars[i + 1] === "्" && "तथदध".indexOf(chars[i + 2]) === -1)) {
        chars[i] = "ன";
      }
    }
  }
  return chars.join("");
}


function brahmic_convert(s, from, to) {
  if (!from || !to) {
    return s;
  }
  if (from === to) {
    return s;
  }
  s = s.normalize();
  if (from == "ISO") {
    s = unfix_iso(s);
  }
  let set = new Set();
  let entries = brahmic_map.map(x => [fix_string(x[from]), fix_string(x[to])]).filter(([k, v]) => {
    if (set.has(k)) return false;
    set.add(k);
    return true;
  });
  let map = Object.fromEntries(entries);
  let keys = Object.keys(map).filter(x => x.length > 0).sort((x, y) => y.length - x.length);
  keys.forEach(key => {
    s = s.replaceAll(key, map[key]);
  });
  if (to == "ISO") {
    if (from == "Tamil") {
      return fix_iso_tamil(s);
    } else {
      return fix_iso(s);
    }
  }
  if (to == "Tamil") {
    return fix_tamil(s);
  }
  return s;
}

function iso_convert(s, to) {
  if (!to) {
    return s;
  }
  s = s.normalize();
  let from = "ISO";
  let map = Object.fromEntries(ipa_map.map(x => [fix_string(x[from]), fix_string(x[to])]));
  let keys = Object.keys(map).sort((x, y) => y.length - x.length);
  keys.forEach(key => {
    s = s.replaceAll(key, map[key]);
  });
  if (to === "Tamil") {
    return fix_ipa_tamil(s);
  }
  return fix_ipa(s);
}

function transcribe_string(string, from, to) {
  if (to.indexOf("IPA") === 0) {
    return iso_convert(brahmic_convert(string, from, "ISO"), to.substr(4));
  }
  return brahmic_convert(string, from, to);
}

let title = document.title;
let originals = new WeakMap();
function transcribe_node(node, from, to) {
  if (node.nodeType === Node.TEXT_NODE) {
    if (!from) {
      if (originals.has(node)) {
        node.nodeValue = originals.get(node);
      }
    } else {
      originals.set(node, node.nodeValue);
      node.nodeValue = transcribe_string(node.nodeValue, from, to);
    }
  } else if (node.nodeType === Node.ELEMENT_NODE) {
    if (node.lang !== "") return;
    for (let i = 0; i < node.childNodes.length; i++) {
      let child = node.childNodes[i];
      transcribe_node(child, from, to);
    }
  }
}

function transcribe_document(from, to) {
  transcribe_node(document.body, from, to);
  if (from) {
    document.title = transcribe_string(title, from, to);
  } else {
    document.title = title;
  }
}

function reset() {
  transcribe_document(null, null);
}
